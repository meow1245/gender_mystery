<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>⚧ 性別議題零距離：數位遊戲化教育方案 ⚧</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="bg-pattern"></div>

    <div class="container">
        <header class="main-header">
            <h1>⚧ 性別議題零距離 ⚧</h1>
            <p class="subtitle">✨ 數位遊戲化教育方案 ✨</p>
        </header>

        <button class="music-fab" id="musicToggle">🎵</button>

        <div id="homeScreen" class="screen active">
            <div class="intro-card">
                <h3>🌈 方案介紹</h3>
                <p>歡迎體驗<b>性別科技與社會</b>課程開發的數位教育方案。我們透過<b>劇本殺</b> 的形式，縮短大眾與性別議題的距離。</p>
                <ul class="intro-list">
                    <li>🕵️ <b>角色扮演</b>：換位思考，同理多元性別處境。</li>
                    <li>🔍 <b>數位敘事</b>：蒐集 Log、截圖等數位證據。</li>
                    <li>⚖️ <b>倫理決策</b>：在兩難中反思正義與結構性問題。</li>
                </ul>
                <div class="tag-group">
                    <span class="tag">#多元性別</span>
                    <span class="tag">#數位暴力防治</span>
                    <span class="tag">#性別科技</span>
                </div>
            </div>

            <div class="btn-row" style="margin-bottom: 20px;">
                <button id="btnOpenMusicRoom" class="btn-secondary full-width">🎧 進入情境音樂室</button>
            </div>

            <div class="action-area">
                <div class="input-group">
                    <input type="text" id="playerName" placeholder="請輸入參與者暱稱 ✨">
                </div>
                <div class="btn-row">
                    <button id="btnCreateRoom" class="btn-primary">📝 建立教育場域</button>
                    <button id="btnJoinRoom" class="btn-secondary">🚀 加入現有場域</button>
                </div>
            </div>
        </div>

        <div id="musicScreen" class="screen">
            <h2 class="screen-title">🎶 情境音樂室</h2>
            <p style="text-align:center; color:#888; margin-bottom:20px; font-size:0.9em;">點擊播放，感受不同議題的氛圍 ✨</p>
            
            <div class="music-list-container" id="fullMusicList">
                </div>
            
            <button id="btnBackFromMusic" class="btn-back">🔙 返回大廳</button>
        </div>

        <div id="createRoomScreen" class="screen">
            <h2 class="screen-title">📚 選擇議題類型</h2>
            <div class="script-type-selector">
                <div class="script-card teen" id="selectTeenType">
                    <div class="icon">🌱</div>
                    <h3>未成年/校園</h3>
                    <p>霸凌、情感教育、身體界線</p>
                </div>
                <div class="script-card adult" id="selectAdultType">
                    <div class="icon">💼</div>
                    <h3>成年/社會</h3>
                    <p>職場權力、數位性別暴力</p>
                </div>
            </div>
            <button id="btnBackToHomeFromCreate" class="btn-back">🔙 返回</button>
        </div>

        <div id="selectPlayerCountScreen" class="screen">
            <h2 class="screen-title">👥 選擇參與人數</h2>
            <div class="room-size-grid">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="room-size-btn" data-size="3">3人</button>
                    <button class="room-size-btn" data-size="4">4人</button>
                    <button class="room-size-btn" data-size="5">5人</button>
                    <button class="room-size-btn" data-size="6">6人</button>
                </div>
            </div>
            <button id="btnBackToScriptType" class="btn-back">🔙 返回</button>
        </div>

        <div id="selectScriptScreen" class="screen">
            <h2 class="screen-title">📖 選擇教案劇本</h2>
            <div class="script-list" id="scriptList"></div>
            <button id="btnBackToPlayerCount" class="btn-back">🔙 返回</button>
        </div>

        <div id="joinRoomScreen" class="screen">
            <h2 class="screen-title">🔑 輸入場域代碼</h2>
            <div class="input-group">
                <input type="text" id="roomCodeInput" placeholder="輸入6位代碼" maxlength="6" class="code-input" style="text-transform: uppercase;">
            </div>
            <button id="btnConfirmJoin" class="btn-primary full-width">確認加入</button>
            <button id="btnBackToHomeFromJoin" class="btn-back full-width">🔙 返回</button>
        </div>

        <div id="lobbyScreen" class="screen">
            <div class="lobby-info">
                <div class="room-code-badge">
                    <span>代碼</span>
                    <strong id="displayRoomCode">------</strong>
                </div>
                <div class="script-info">
                    <h3 id="displayScriptName">教案載入中...</h3>
                    <p>⏳ <span id="displayDuration">--</span> | 👥 <span id="currentPlayers">0</span>/<span id="maxPlayers">0</span></p>
                </div>
            </div>
            <div class="player-grid" id="playersList"></div>
            <div class="lobby-actions">
                <div id="hostControls" style="display:none; width: 100%;">
                    <button id="btnStartGame" class="btn-primary full-width">🚀 開始體驗</button>
                </div>
                <button id="btnLeaveRoom" class="btn-danger full-width" style="margin-top: 10px;">👋 離開場域</button>
            </div>
        </div>

        <div id="gameScreen" class="screen game-layout">
            <div class="game-header">
                <div class="day-badge" id="dayIndicator">Day 1</div>
                <div class="phase-badge" id="phaseInfo">早晨</div>
                <div class="timer-badge" id="timer">00:00</div>
            </div>

            <div class="game-scroll-area">
                <div class="character-panel">
                    <div class="char-header">
                        <img id="characterPortrait" src="" alt="Avatar" style="display:none;">
                        <div class="char-info">
                            <h3 id="characterName">角色名</h3>
                            <span class="role-label">你的角色</span>
                        </div>
                    </div>
                    <div class="char-details">
                        <p><strong>📜 背景：</strong><span id="characterBackground"></span></p>
                        <p><strong>🤫 秘密：</strong><span id="characterSecret" class="blur-text">點擊查看秘密</span></p>
                        <p id="characterGoal" class="goal-text" style="color: #e74c3c; margin-top: 5px;"></p>
                    </div>
                    <div id="characterClue" class="clue-box" style="display:none; margin-top: 10px; background: #fff3cd; padding: 10px; border-radius: 8px;">
                        <h4>🔎 新線索</h4>
                        <p id="clueContent"></p>
                    </div>
                </div>

                <div class="event-toast" id="eventCard" style="display:none; background: #d4edda; color: #155724; padding: 10px; border-radius: 8px; margin: 10px 0;">
                    <h4>📢 事件</h4>
                    <p id="eventContent"></p>
                </div>

                <div class="chat-box" id="chatContainer"></div>
                
                <div class="vote-panel" id="voteSection" style="display:none;">
                    <h3>🗳️ 請投票</h3>
                    <p id="votePrompt"></p>
                    <div class="vote-grid" id="voteButtons"></div>
                </div>

                <div id="gameResult" class="result-modal" style="display:none;"></div>
            </div>

            <div class="game-footer">
                <div class="message-input-area">
                    <input type="text" id="messageInput" placeholder="輸入訊息...">
                    <button id="btnSendMessage" class="btn-send">➤</button>
                </div>
                
                <div class="message-options">
                    <div id="btnMessageType" class="custom-select-btn">📢 公開</div>
                    
                    <input type="hidden" id="msgTypeInput" value="public">
                    <input type="hidden" id="privateTargetInput" value="">

                    <div id="btnPrivateTarget" class="custom-select-btn" style="display:none;">選擇對象 ▼</div>
                    
                    <button id="endTurnBtn" class="btn-end-turn" style="background-color: #ffc107; border: none; color: white; display:none;">✅ 結束發言</button>

                    <div id="targetMenu" class="custom-dropup"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="scripts.js"></script>
</body>
</html>